<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>可愛稻田數字遊戲</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #FFF6E9;
            color: #7d4b33;
            padding: 10px;
            text-align: center;
            max-width: 100%;
            overflow-x: hidden;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657l1.415 1.414L13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83z' fill='%23f8e2d3' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
        }
        
        h1 {
            color: #e5855e;
            font-size: 24px;
            margin: 10px 0 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #f0a07b;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .game-container {
            background-color: #FFF6E9;
            margin: 0 auto 15px;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            max-width: 500px;
            border: 2px dashed #f5c8b0;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
        }
        
        button {
            background-color: #e5855e;
            border: none;
            color: white;
            padding: 8px 15px;
            font-size: 15px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.2s, transform 0.1s;
        }
        
        button:hover, button:active {
            background-color: #d16544;
            transform: translateY(-1px);
        }
        
        button.active {
            background-color: #d16544;
            font-weight: bold;
        }
        
        .info-panel {
            display: flex;
            justify-content: space-between;
            background-color: #f7c5a8;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .info-item {
            flex: 1;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 8px;
            margin: 0 auto 15px;
        }
        
        .cell {
            position: relative;
            width: 100%;
            padding-bottom: 100%;
            background-color: #FFE9D6;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 2px solid #f5c8b0;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            overflow: hidden;
        }
        
        .cell:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h20v20H0V0zm20 20h20v20H20V20zM0 20h20v20H0V20zm20-20h20v20H20V0z' fill='%23f7d6c3' fill-opacity='0.3' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.3;
        }
        
        .cell span {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #7d4b33;
        }
        
        .cell:hover, .cell:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .cell.correct {
            background-color: #D5ECC2;
            border-color: #ACD278;
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        .rules-box {
            background-color: #FFF0E0;
            border-radius: 12px;
            padding: 12px;
            margin: 15px auto;
            text-align: center;
            border: 2px dashed #f5c8b0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .rules-title {
            color: #e5855e;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .mode-header {
            color: #d16544;
            font-size: 16px;
            font-weight: bold;
            margin-top: 8px;
            margin-bottom: 5px;
        }
        
        .rules-content ul {
            padding: 0;
            margin: 5px 0;
        }
        
        .rules-content li {
            margin: 5px 0;
            list-style-type: none;
            font-size: 14px;
        }
        
        .scores-container {
            background-color: #FFF6E9;
            border-radius: 15px;
            padding: 15px;
            margin: 0 auto;
            max-width: 500px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border: 2px dashed #f5c8b0;
        }
        
        .scores-title {
            color: #e5855e;
            font-size: 18px;
            font-weight: bold;
            margin: 5px 0 15px;
        }
        
        .mode-records {
            background-color: #FFF6E9;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .mode-title {
            color: #e5855e;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            background-color: #FFE9D6;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .best-score {
            font-size: 15px;
            color: #e5855e;
            margin-bottom: 10px;
            text-align: left;
            padding: 10px;
            background-color: #FFF0E0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            background-color: #FFF0E0;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .score-date {
            color: #f0a07b;
            font-size: 12px;
            margin-left: 5px;
        }
        
        @media (max-width: 500px) {
            body {
                padding: 5px;
            }
            
            h1 {
                font-size: 20px;
                margin: 8px 0 4px;
            }
            
            .subtitle {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .game-container, .scores-container {
                padding: 10px;
            }
            
            .controls {
                margin-bottom: 10px;
            }
            
            button {
                padding: 6px 12px;
                font-size: 14px;
            }
            
            .info-panel {
                padding: 8px;
                margin-bottom: 10px;
                font-size: 14px;
            }
            
            .grid {
                grid-gap: 5px;
            }
            
            .cell span {
                font-size: 18px;
            }
            
            .rules-box {
                padding: 10px;
                margin: 10px auto;
            }
            
            .rules-title, .scores-title {
                font-size: 16px;
            }
            
            .mode-header, .mode-title {
                font-size: 15px;
            }
            
            .rules-content li {
                font-size: 13px;
                margin: 4px 0;
            }
            
            .best-score, .score-item {
                padding: 8px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 350px) {
            .cell span {
                font-size: 16px;
            }
            
            button {
                padding: 5px 10px;
                font-size: 13px;
            }
            
            .info-panel {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <h1>可愛稻田數字遊戲</h1>
    <p class="subtitle">Cute Rice Field Number Game</p>
    
    <div class="game-container">
        <div class="controls">
            <div class="button-group">
                <button id="easyBtn" class="active">簡單版</button>
                <button id="hardBtn">困難版</button>
            </div>
            <button id="startBtn">開始遊戲</button>
        </div>
        
        <div class="info-panel">
            <div class="info-item">
                <div>模式:</div>
                <div id="modeDisplay">簡單</div>
            </div>
            <div class="info-item">
                <div>下一個:</div>
                <div id="nextNumber">1</div>
            </div>
            <div class="info-item">
                <div>時間:</div>
                <div id="time">0.0 s</div>
            </div>
        </div>
        
        <div class="grid" id="grid"></div>
        
        <div class="rules-box">
            <div class="rules-title">遊戲規則</div>
            <div class="rules-content">
                <p class="mode-header">簡單版:</p>
                <ul>
                    <li>尋找並點擊數字 1-25，需要按照順序點擊</li>
                    <li>時間從點擊第一個數字開始計算</li>
                    <li>用最短的時間完成所有數字點擊</li>
                </ul>
                
                <p class="mode-header">困難版:</p>
                <ul>
                    <li>尋找並點擊數字 3, 6, 9...到75，需要按照順序點擊</li>
                    <li>每隔幾秒鐘，未點擊的數字會重新排列位置</li>
                    <li>挑戰更高難度，測試你的反應和專注力</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="scores-container">
        <h3 class="scores-title">遊戲紀錄</h3>
        
        <div class="mode-records">
            <div class="mode-title">簡單版</div>
            <div class="best-score">
                <div>最佳紀錄: <span id="easyBestScore">--</span></div>
            </div>
            <div id="easyRecentScores">
                <div class="score-item">
                    <div>尚無紀錄</div>
                    <div>--</div>
                </div>
            </div>
        </div>
        
        <div class="mode-records">
            <div class="mode-title">困難版</div>
            <div class="best-score">
                <div>最佳紀錄: <span id="hardBestScore">--</span></div>
            </div>
            <div id="hardRecentScores">
                <div class="score-item">
                    <div>尚無紀錄</div>
                    <div>--</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 基本元素
        const grid = document.getElementById('grid');
        const startBtn = document.getElementById('startBtn');
        const easyBtn = document.getElementById('easyBtn');
        const hardBtn = document.getElementById('hardBtn');
        const timeDisplay = document.getElementById('time');
        const nextNumberDisplay = document.getElementById('nextNumber');
        const modeDisplay = document.getElementById('modeDisplay');
        const easyBestScore = document.getElementById('easyBestScore');
        const hardBestScore = document.getElementById('hardBestScore');
        const easyRecentScores = document.getElementById('easyRecentScores');
        const hardRecentScores = document.getElementById('hardRecentScores');
        
        // 遊戲變數
        let numbers = [];
        let currentNumber = 1;
        let startTime = 0;
        let timerInterval = null;
        let gameStarted = false;
        let isHardMode = false;
        let hardModeShuffleTimer = null;
        
        // 遊戲紀錄
        let gameRecords = {
            easy: { best: null, recent: [] },
            hard: { best: null, recent: [] }
        };
        
        // 從localStorage加載遊戲記錄
        try {
            const savedRecords = localStorage.getItem('numberGameRecords');
            if (savedRecords) {
                gameRecords = JSON.parse(savedRecords);
            }
        } catch (error) {
            console.log('無法載入記錄');
        }
        
        // 初始化遊戲
        function initGame() {
            clearAllTimers();
            grid.innerHTML = '';
            currentNumber = 1;
            gameStarted = false;
            timeDisplay.textContent = '0.0 s';
            
            if (isHardMode) {
                numbers = Array.from({length: 25}, (_, i) => (i + 1) * 3);
                nextNumberDisplay.textContent = '3';
            } else {
                numbers = Array.from({length: 25}, (_, i) => i + 1);
                nextNumberDisplay.textContent = '1';
            }
            
            // 打亂數字順序
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }
            
            // 創建網格
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.innerHTML = '<span>' + numbers[i] + '</span>';
                cell.dataset.number = numbers[i];
                
                cell.addEventListener('click', function() {
                    const clickedNumber = parseInt(this.dataset.number);
                    const targetNumber = isHardMode ? currentNumber * 3 : currentNumber;
                    
                    if (clickedNumber === targetNumber) {
                        if (!gameStarted) {
                            startTime = Date.now();
                            gameStarted = true;
                            
                            timerInterval = setInterval(function() {
                                const elapsed = (Date.now() - startTime) / 1000;
                                timeDisplay.textContent = elapsed.toFixed(1) + ' s';
                            }, 100);
                            
                            if (isHardMode) {
                                scheduleShuffling();
                            }
                        }
                        
                        this.classList.add('correct');
                        currentNumber++;
                        
                        if (currentNumber <= 25) {
                            nextNumberDisplay.textContent = isHardMode ? (currentNumber * 3) : currentNumber;
                        } else {
                            gameCompleted();
                        }
                    }
                });
                
                grid.appendChild(cell);
            }
            
            updateModeDisplay();
        }
        
        // 更新模式顯示
        function updateModeDisplay() {
            modeDisplay.textContent = isHardMode ? '困難' : '簡單';
            easyBtn.classList.toggle('active', !isHardMode);
            hardBtn.classList.toggle('active', isHardMode);
        }
        
        // 開始困難模式洗牌
        function scheduleShuffling() {
            if (hardModeShuffleTimer) {
                clearTimeout(hardModeShuffleTimer);
            }
            
            hardModeShuffleTimer = setTimeout(function() {
                if (gameStarted) {
                    shuffleRemaining();
                    scheduleShuffling();
                }
            }, 8000);
        }
        
        // 洗牌剩餘數字
        function shuffleRemaining() {
            const unclickedCells = Array.from(document.querySelectorAll('.cell:not(.correct)'));
            
            if (unclickedCells.length > 1) {
                // 取得數字
                const remainingNumbers = unclickedCells.map(cell => parseInt(cell.dataset.number));
                
                // 打亂數字
                for (let i = remainingNumbers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [remainingNumbers[i], remainingNumbers[j]] = [remainingNumbers[j], remainingNumbers[i]];
                }
                
                // 重設數字
                unclickedCells.forEach((cell, index) => {
                    cell.dataset.number = remainingNumbers[index];
                    cell.querySelector('span').textContent = remainingNumbers[index];
                });
            }
        }
        
        // 遊戲完成
        function gameCompleted() {
            clearAllTimers();
            nextNumberDisplay.textContent = '完成!';
            
            const finalTime = (Date.now() - startTime) / 1000;
            saveScore(finalTime);
            updateScoreDisplay();
        }
        
        // 清除所有計時器
        function clearAllTimers() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            if (hardModeShuffleTimer) {
                clearTimeout(hardModeShuffleTimer);
                hardModeShuffleTimer = null;
            }
        }
        
        // 保存分數
        function saveScore(time) {
            const mode = isHardMode ? 'hard' : 'easy';
            const formattedTime = time.toFixed(1);
            const today = new Date().toLocaleDateString();
            
            // 添加新紀錄
            gameRecords[mode].recent.unshift({
                time: formattedTime,
                date: today
            });
            
            // 只保留前2筆
            if (gameRecords[mode].recent.length > 2) {
                gameRecords[mode].recent.pop();
            }
            
            // 更新最佳成績
            if (gameRecords[mode].best === null || time < gameRecords[mode].best) {
                gameRecords[mode].best = formattedTime;
            }
            
            // 儲存到localStorage
            try {
                localStorage.setItem('numberGameRecords', JSON.stringify(gameRecords));
            } catch (error) {
                console.log('無法儲存記錄');
            }
        }
        
        // 更新分數顯示
        function updateScoreDisplay() {
            // 簡單模式
            easyBestScore.textContent = gameRecords.easy.best ? gameRecords.easy.best + ' 秒' : '--';
            
            let easyHTML = '';
            if (gameRecords.easy.recent.length === 0) {
                easyHTML = '<div class="score-item"><div>尚無紀錄</div><div>--</div></div>';
            } else {
                gameRecords.easy.recent.forEach((record, i) => {
                    easyHTML += `<div class="score-item">
                        <div>#${i+1} <span class="score-date">${record.date}</span></div>
                        <div>${record.time} 秒</div>
                    </div>`;
                });
            }
            easyRecentScores.innerHTML = easyHTML;
            
            // 困難模式
            hardBestScore.textContent = gameRecords.hard.best ? gameRecords.hard.best + ' 秒' : '--';
            
            let hardHTML = '';
            if (gameRecords.hard.recent.length === 0) {
                hardHTML = '<div class="score-item"><div>尚無紀錄</div><div>--</div></div>';
            } else {
                gameRecords.hard.recent.forEach((record, i) => {
                    hardHTML += `<div class="score-item">
                        <div>#${i+1} <span class="score-date">${record.date}</span></div>
                        <div>${record.time} 秒</div>
                    </div>`;
                });
            }
            hardRecentScores.innerHTML = hardHTML;
        }
        
        // 事件處理
        startBtn.addEventListener('click', initGame);
        
        easyBtn.addEventListener('click', function() {
            isHardMode = false;
            initGame();
            updateScoreDisplay();
        });
        
        hardBtn.addEventListener('click', function() {
            isHardMode = true;
            initGame();
            updateScoreDisplay();
        });
        
        // 初始化
        initGame();
        updateScoreDisplay();
    </script>
</body>
</html>
